# âš™ï¸ FR-005: ì‚¬ìš©ì ìœ„ì¹˜ ì„¤ì •

## ğŸ“‹ ë¬¸ì„œ ì •ë³´

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ê¸°ëŠ¥ ID** | FR-005 |
| **ë²„ì „** | 1.0 |
| **ì‘ì„±ì¼** | 2024ë…„ 12ì›” 4ì¼ |
| **ìš°ì„ ìˆœìœ„** | ğŸ”´ í•„ìˆ˜ |
| **ì˜ˆìƒ ê³µìˆ˜** | 2ì¼ |
| **ìƒíƒœ** | ğŸ“ ì‘ì„±ì™„ë£Œ |

---

## ğŸ¯ ê¸°ëŠ¥ ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ê¸°ëŠ¥ëª…** | ì‚¬ìš©ì ìœ„ì¹˜ ì„¤ì • |
| **ì„¤ëª…** | GPSë¥¼ í†µí•œ í˜„ì¬ ìœ„ì¹˜ ìë™ ê°ì§€ ë˜ëŠ” ë„ì‹œëª… ê²€ìƒ‰ì„ í†µí•œ ìˆ˜ë™ ìœ„ì¹˜ ì„¤ì • |
| **ì…ë ¥** | GPS ì¢Œí‘œ ë˜ëŠ” ê²€ìƒ‰ì–´ (ë„ì‹œëª…) |
| **ì¶œë ¥** | ìœ„ì¹˜ ì¢Œí‘œ (ìœ„ë„/ê²½ë„) + ìœ„ì¹˜ëª… |

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

| ë¬¸ì„œ | ì—­í•  |
|------|------|
| [US-001](../user-stories/US-001.md) | ê´€ë ¨ ì‚¬ìš©ì ìŠ¤í† ë¦¬ |
| [US-002](../user-stories/US-002.md) | ê´€ë ¨ ì‚¬ìš©ì ìŠ¤í† ë¦¬ |
| [FR-001](./FR-001.md) | í›„í–‰ ê¸°ëŠ¥ (ë‚ ì”¨ ì¡°íšŒ) |
| [open_weather_api.md](../../api_docs/open_weather_api.md) | Geocoding API ë¬¸ì„œ |
| [design_system.md](../../design_system.md) | UI ë””ìì¸ ê°€ì´ë“œ |
| [DEVELOPMENT_GUIDE.md](../../DEVELOPMENT_GUIDE.md) | ê°œë°œ ê°€ì´ë“œ |

---

## ğŸ“¡ API ì—°ë™ ëª…ì„¸

### 1. Browser Geolocation API

ë¸Œë¼ìš°ì € ë‚´ì¥ Geolocation APIë¥¼ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ìœ„ì¹˜ë¥¼ íšë“í•©ë‹ˆë‹¤.

```typescript
// í˜„ì¬ ìœ„ì¹˜ íšë“
navigator.geolocation.getCurrentPosition(
  (position) => {
    const { latitude, longitude } = position.coords;
    // ìœ„ì¹˜ íšë“ ì„±ê³µ
  },
  (error) => {
    // ì—ëŸ¬ ì²˜ë¦¬
    switch (error.code) {
      case error.PERMISSION_DENIED:
        // ê¶Œí•œ ê±°ë¶€
        break;
      case error.POSITION_UNAVAILABLE:
        // ìœ„ì¹˜ ì •ë³´ ì‚¬ìš© ë¶ˆê°€
        break;
      case error.TIMEOUT:
        // íƒ€ì„ì•„ì›ƒ
        break;
    }
  },
  {
    enableHighAccuracy: true,
    timeout: 10000,
    maximumAge: 60000,
  }
);
```

### 2. OpenWeatherMap Geocoding API

ë„ì‹œëª…ì„ ì¢Œí‘œë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì—”ë“œí¬ì¸íŠ¸** | `http://api.openweathermap.org/geo/1.0/direct` |
| **ë©”ì„œë“œ** | GET |

### ìš”ì²­ íŒŒë¼ë¯¸í„°

| íŒŒë¼ë¯¸í„° | í•„ìˆ˜ | íƒ€ì… | ì„¤ëª… |
|---------|------|------|------|
| `q` | âœ… | string | ê²€ìƒ‰ì–´ (ë„ì‹œëª…) |
| `limit` | â¬œ | number | ê²°ê³¼ ê°œìˆ˜ (ê¸°ë³¸ 5) |
| `appid` | âœ… | string | API í‚¤ |

### ìš”ì²­ ì˜ˆì‹œ

```typescript
const response = await apiClient.get(
  'http://api.openweathermap.org/geo/1.0/direct',
  {
    params: {
      q: 'ê°•ë‚¨ì—­',
      limit: 5,
      appid: env.OPENWEATHER_API_KEY,
    },
  }
);
```

### ì‘ë‹µ ë°ì´í„°

```typescript
interface GeocodingResult {
  name: string;           // ì¥ì†Œëª…
  local_names?: {
    ko?: string;          // í•œêµ­ì–´ ì´ë¦„
    en?: string;          // ì˜ì–´ ì´ë¦„
    // ... ê¸°íƒ€ ì–¸ì–´
  };
  lat: number;            // ìœ„ë„
  lon: number;            // ê²½ë„
  country: string;        // êµ­ê°€ ì½”ë“œ
  state?: string;         // ì§€ì—­/ì£¼
}
```

### 3. OpenWeatherMap Reverse Geocoding API (ì„ íƒ)

ì¢Œí‘œë¥¼ ë„ì‹œëª…ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤ (GPS ìœ„ì¹˜ì˜ ì´ë¦„ í‘œì‹œìš©).

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì—”ë“œí¬ì¸íŠ¸** | `http://api.openweathermap.org/geo/1.0/reverse` |
| **ë©”ì„œë“œ** | GET |

### ìš”ì²­ íŒŒë¼ë¯¸í„°

| íŒŒë¼ë¯¸í„° | í•„ìˆ˜ | íƒ€ì… | ì„¤ëª… |
|---------|------|------|------|
| `lat` | âœ… | number | ìœ„ë„ |
| `lon` | âœ… | number | ê²½ë„ |
| `limit` | â¬œ | number | ê²°ê³¼ ê°œìˆ˜ |
| `appid` | âœ… | string | API í‚¤ |

---

## ğŸ—‚ï¸ ë°ì´í„° ëª¨ë¸

### Location íƒ€ì…

```typescript
// types/location.ts

export interface Location {
  lat: number;           // ìœ„ë„
  lon: number;           // ê²½ë„
  name?: string;         // ìœ„ì¹˜ëª…
  country?: string;      // êµ­ê°€ ì½”ë“œ
  state?: string;        // ì§€ì—­ëª…
}

export interface GeocodingSearchResult {
  name: string;          // í‘œì‹œëª…
  fullName: string;      // ì „ì²´ ì£¼ì†Œ (ì˜ˆ: "ê°•ë‚¨ì—­, ì„œìš¸, KR")
  location: Location;    // ì¢Œí‘œ
}

export interface LocationState {
  currentLocation: Location | null;
  selectedLocation: Location | null;
  isGPSPermissionGranted: boolean;
  isGPSLoading: boolean;
  recentLocations: Location[];
}
```

---

## ğŸ—ï¸ êµ¬í˜„ ëª…ì„¸

### ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
src/
â”œâ”€â”€ services/
â”‚   â””â”€â”€ location/
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ locationService.ts   # ìœ„ì¹˜ ê´€ë ¨ ì„œë¹„ìŠ¤
â”‚       â”œâ”€â”€ geocodingService.ts  # Geocoding API
â”‚       â””â”€â”€ locationUtils.ts     # ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useGeolocation.ts        # GPS Hook
â”‚   â”œâ”€â”€ useGeocodingSearch.ts    # ê²€ìƒ‰ Hook
â”‚   â””â”€â”€ useLocation.ts           # í†µí•© Hook
â”œâ”€â”€ components/
â”‚   â””â”€â”€ location/
â”‚       â”œâ”€â”€ LocationPermissionModal.tsx  # ê¶Œí•œ ìš”ì²­ ëª¨ë‹¬
â”‚       â”œâ”€â”€ LocationSearchInput.tsx      # ê²€ìƒ‰ ì…ë ¥ì°½
â”‚       â”œâ”€â”€ LocationSearchResults.tsx    # ê²€ìƒ‰ ê²°ê³¼
â”‚       â”œâ”€â”€ RecentLocations.tsx          # ìµœê·¼ ê²€ìƒ‰
â”‚       â””â”€â”€ CurrentLocationButton.tsx    # í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ LocationSearchPage.tsx    # ìœ„ì¹˜ ê²€ìƒ‰ í˜ì´ì§€
â””â”€â”€ stores/
    â””â”€â”€ locationStore.ts          # ìœ„ì¹˜ ìƒíƒœ ê´€ë¦¬
```

### GPS ìœ„ì¹˜ íšë“ Hook

```typescript
// hooks/useGeolocation.ts
import { useState, useCallback } from 'react';
import type { Location } from '@/types/location';
import { locationService } from '@/services/location';

export const useGeolocation = () => {
  const [location, setLocation] = useState<Location | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<GeolocationPositionError | null>(null);

  const getCurrentLocation = useCallback(async () => {
    if (!navigator.geolocation) {
      setError({ code: 0, message: 'Geolocation not supported' } as any);
      return;
    }

    setIsLoading(true);
    setError(null);

    try {
      const position = await new Promise<GeolocationPosition>(
        (resolve, reject) => {
          navigator.geolocation.getCurrentPosition(resolve, reject, {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 60000,
          });
        }
      );

      const { latitude, longitude } = position.coords;

      // ì—­ ì§€ì˜¤ì½”ë”©ìœ¼ë¡œ ìœ„ì¹˜ëª… íšë“
      const locationInfo = await locationService.reverseGeocode(
        latitude,
        longitude
      );

      const newLocation: Location = {
        lat: latitude,
        lon: longitude,
        name: locationInfo.name,
        country: locationInfo.country,
      };

      setLocation(newLocation);
      return newLocation;
    } catch (err) {
      setError(err as GeolocationPositionError);
      throw err;
    } finally {
      setIsLoading(false);
    }
  }, []);

  return {
    location,
    isLoading,
    error,
    getCurrentLocation,
    isSupported: !!navigator.geolocation,
  };
};
```

### Geocoding ê²€ìƒ‰ Hook

```typescript
// hooks/useGeocodingSearch.ts
import { useQuery } from '@tanstack/react-query';
import { geocodingService } from '@/services/location';

export const useGeocodingSearch = (query: string) => {
  return useQuery({
    queryKey: ['geocoding', query],
    queryFn: () => geocodingService.search(query),
    enabled: query.length >= 2,
    staleTime: 5 * 60 * 1000,
  });
};
```

### Geocoding ì„œë¹„ìŠ¤

```typescript
// services/location/geocodingService.ts
import { apiClient } from '@/configs/api';
import { env } from '@/configs/env';
import type { GeocodingSearchResult } from '@/types/location';

export const geocodingService = {
  /**
   * ë„ì‹œëª…ìœ¼ë¡œ ìœ„ì¹˜ ê²€ìƒ‰
   */
  async search(query: string): Promise<GeocodingSearchResult[]> {
    const response = await apiClient.get(
      'http://api.openweathermap.org/geo/1.0/direct',
      {
        params: {
          q: query,
          limit: 5,
          appid: env.OPENWEATHER_API_KEY,
        },
      }
    );

    return response.data.map((item: any) => ({
      name: item.local_names?.ko || item.name,
      fullName: [
        item.local_names?.ko || item.name,
        item.state,
        item.country,
      ]
        .filter(Boolean)
        .join(', '),
      location: {
        lat: item.lat,
        lon: item.lon,
        name: item.local_names?.ko || item.name,
        country: item.country,
        state: item.state,
      },
    }));
  },
};
```

### Zustand ìŠ¤í† ì–´

```typescript
// stores/locationStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import type { Location } from '@/types/location';

interface LocationState {
  selectedLocation: Location | null;
  recentLocations: Location[];
  isGPSPermissionGranted: boolean;
  
  setSelectedLocation: (location: Location) => void;
  addRecentLocation: (location: Location) => void;
  setGPSPermission: (granted: boolean) => void;
  clearRecentLocations: () => void;
}

const MAX_RECENT_LOCATIONS = 5;

export const useLocationStore = create<LocationState>()(
  persist(
    (set, get) => ({
      selectedLocation: null,
      recentLocations: [],
      isGPSPermissionGranted: false,

      setSelectedLocation: (location) => {
        set({ selectedLocation: location });
        get().addRecentLocation(location);
      },

      addRecentLocation: (location) => {
        const { recentLocations } = get();
        // ì¤‘ë³µ ì œê±° í›„ ì¶”ê°€
        const filtered = recentLocations.filter(
          (l) => l.lat !== location.lat || l.lon !== location.lon
        );
        const updated = [location, ...filtered].slice(0, MAX_RECENT_LOCATIONS);
        set({ recentLocations: updated });
      },

      setGPSPermission: (granted) => set({ isGPSPermissionGranted: granted }),

      clearRecentLocations: () => set({ recentLocations: [] }),
    }),
    {
      name: 'location-storage',
      partialize: (state) => ({
        recentLocations: state.recentLocations,
      }),
    }
  )
);
```

---

## ğŸ¨ UI ì»´í¬ë„ŒíŠ¸ ëª…ì„¸

### LocationSearchPage êµ¬ì¡°

```typescript
// pages/LocationSearchPage.tsx
export const LocationSearchPage = () => {
  const [searchQuery, setSearchQuery] = useState('');
  const { data: searchResults, isLoading } = useGeocodingSearch(searchQuery);
  const { getCurrentLocation, isLoading: isGPSLoading } = useGeolocation();
  const { recentLocations, setSelectedLocation } = useLocationStore();
  const navigate = useNavigate();

  const handleSelectLocation = (location: Location) => {
    setSelectedLocation(location);
    navigate('/');
  };

  const handleUseCurrentLocation = async () => {
    try {
      const location = await getCurrentLocation();
      if (location) {
        handleSelectLocation(location);
      }
    } catch (error) {
      // ì—ëŸ¬ ì²˜ë¦¬
    }
  };

  return (
    <div className="min-h-screen bg-cream">
      <LocationSearchHeader onBack={() => navigate(-1)} />
      
      <div className="container py-4 space-y-4">
        <LocationSearchInput
          value={searchQuery}
          onChange={setSearchQuery}
          isLoading={isLoading}
        />
        
        <CurrentLocationButton
          onClick={handleUseCurrentLocation}
          isLoading={isGPSLoading}
        />
        
        {searchQuery.length >= 2 && searchResults ? (
          <LocationSearchResults
            results={searchResults}
            onSelect={handleSelectLocation}
          />
        ) : (
          <RecentLocations
            locations={recentLocations}
            onSelect={handleSelectLocation}
          />
        )}
      </div>
    </div>
  );
};
```

### í™”ë©´ ë ˆì´ì•„ì›ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† ìœ„ì¹˜ ê²€ìƒ‰                         â”‚  â† í—¤ë”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ” ìœ„ì¹˜ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”       âœ•    â”‚â”‚  â† ê²€ìƒ‰ ì…ë ¥ì°½
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚     (ìë™ í¬ì»¤ìŠ¤)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ“ í˜„ì¬ ìœ„ì¹˜ ì‚¬ìš©                â”‚â”‚  â† í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼
â”‚  â”‚    GPSë¡œ í˜„ì¬ ìœ„ì¹˜ë¥¼ ì°¾ìŠµë‹ˆë‹¤    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ìµœê·¼ ê²€ìƒ‰                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ“ ê°•ë‚¨ì—­                        â”‚â”‚
â”‚  â”‚    ì„œìš¸, KR                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ“ í™ëŒ€ì…êµ¬ì—­                    â”‚â”‚
â”‚  â”‚    ì„œìš¸, KR                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  (ê²€ìƒ‰ ì‹œ ê²°ê³¼ í‘œì‹œ)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ“ ê°•ë‚¨ì—­                        â”‚â”‚
â”‚  â”‚    ì„œìš¸ ê°•ë‚¨êµ¬, KR               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ“ ê°•ë‚¨ì—­ 3ë²ˆì¶œêµ¬                â”‚â”‚
â”‚  â”‚    ì„œìš¸ ê°•ë‚¨êµ¬, KR               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### LocationSearchInput ì»´í¬ë„ŒíŠ¸

```typescript
// components/location/LocationSearchInput.tsx
interface LocationSearchInputProps {
  value: string;
  onChange: (value: string) => void;
  isLoading?: boolean;
}

export const LocationSearchInput = ({
  value,
  onChange,
  isLoading,
}: LocationSearchInputProps) => {
  const inputRef = useRef<HTMLInputElement>(null);

  // ìë™ í¬ì»¤ìŠ¤
  useEffect(() => {
    inputRef.current?.focus();
  }, []);

  return (
    <div className="relative">
      <div className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">
        {isLoading ? <Spinner size="sm" /> : <SearchIcon />}
      </div>
      <input
        ref={inputRef}
        type="text"
        value={value}
        onChange={(e) => onChange(e.target.value)}
        placeholder="ìœ„ì¹˜ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”"
        className="w-full h-12 pl-12 pr-10 rounded-lg border border-gray-200
                   focus:border-primary focus:ring-2 focus:ring-primary/20"
      />
      {value && (
        <button
          onClick={() => onChange('')}
          className="absolute right-4 top-1/2 -translate-y-1/2"
        >
          <XIcon />
        </button>
      )}
    </div>
  );
};
```

### LocationPermissionModal ì»´í¬ë„ŒíŠ¸

```typescript
// components/location/LocationPermissionModal.tsx
interface LocationPermissionModalProps {
  isOpen: boolean;
  onAllow: () => void;
  onDeny: () => void;
}

export const LocationPermissionModal = ({
  isOpen,
  onAllow,
  onDeny,
}: LocationPermissionModalProps) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4">
      <div className="bg-white rounded-xl p-6 max-w-sm w-full">
        <div className="text-center mb-6">
          <div className="text-4xl mb-4">ğŸ“</div>
          <h2 className="text-xl font-bold mb-2">ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­</h2>
          <p className="text-gray-600">
            í˜„ì¬ ìœ„ì¹˜ì˜ ë‚ ì”¨ì™€ ì£¼ë³€ ìŒì‹ì ì„ 
            ì°¾ê¸° ìœ„í•´ ìœ„ì¹˜ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.
          </p>
        </div>
        <div className="flex flex-col gap-2">
          <Button onClick={onAllow} variant="primary">
            ìœ„ì¹˜ ì‚¬ìš© í—ˆìš©
          </Button>
          <Button onClick={onDeny} variant="ghost">
            ì§ì ‘ ì…ë ¥í• ê²Œìš”
          </Button>
        </div>
      </div>
    </div>
  );
};
```

---

## âœ… ì¸ìˆ˜ ì¡°ê±´

| ID | ì¡°ê±´ | í…ŒìŠ¤íŠ¸ ë°©ë²• |
|----|------|-----------|
| AC-1 | "í˜„ì¬ ìœ„ì¹˜ ì‚¬ìš©" í´ë¦­ ì‹œ GPS ê¶Œí•œ ìš”ì²­ | ëª¨ë°”ì¼/ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ |
| AC-2 | GPS ê¶Œí•œ í—ˆìš© ì‹œ í˜„ì¬ ìœ„ì¹˜ íšë“ | GPS í…ŒìŠ¤íŠ¸ |
| AC-3 | GPS ê¶Œí•œ ê±°ë¶€ ì‹œ ìˆ˜ë™ ì…ë ¥ ì•ˆë‚´ | ê¶Œí•œ ê±°ë¶€ í…ŒìŠ¤íŠ¸ |
| AC-4 | ìœ„ì¹˜ëª… 2ê¸€ì ì´ìƒ ì…ë ¥ ì‹œ ìë™ì™„ì„± | ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ |
| AC-5 | ìë™ì™„ì„± ê²°ê³¼ 500ms ì´ë‚´ í‘œì‹œ | ì‘ë‹µ ì‹œê°„ ì¸¡ì • |
| AC-6 | ê²€ìƒ‰ ê²°ê³¼ì— ìœ„ì¹˜ëª… + ì§€ì—­ í‘œì‹œ | UI í™•ì¸ |
| AC-7 | ìœ„ì¹˜ ì„ íƒ ì‹œ ì¢Œí‘œ ì €ì¥ | ìŠ¤í† ì–´ í™•ì¸ |
| AC-8 | ìµœê·¼ ê²€ìƒ‰ ìœ„ì¹˜ ìµœëŒ€ 5ê°œ ì €ì¥ | ìŠ¤í† ì–´ í™•ì¸ |
| AC-9 | ìµœê·¼ ê²€ìƒ‰ ìœ„ì¹˜ LocalStorage ìœ ì§€ | ìƒˆë¡œê³ ì¹¨ í›„ í™•ì¸ |
| AC-10 | ê²€ìƒ‰ ì…ë ¥ì°½ ìë™ í¬ì»¤ìŠ¤ | UI í™•ì¸ |
| AC-11 | ê²€ìƒ‰ì–´ ì§€ìš°ê¸° ë²„íŠ¼ ë™ì‘ | í´ë¦­ í…ŒìŠ¤íŠ¸ |
| AC-12 | GPS ë¡œë”© ì¤‘ ìŠ¤í”¼ë„ˆ í‘œì‹œ | UI í™•ì¸ |
| AC-13 | ê²€ìƒ‰ ê²°ê³¼ ì—†ì„ ë•Œ ì•ˆë‚´ ë©”ì‹œì§€ | ì—†ëŠ” ê²€ìƒ‰ì–´ í…ŒìŠ¤íŠ¸ |

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

```typescript
// hooks/useGeolocation.test.ts
describe('useGeolocation', () => {
  it('should get current location', async () => {
    const mockPosition = {
      coords: { latitude: 37.5665, longitude: 126.9780 },
    };
    
    jest.spyOn(navigator.geolocation, 'getCurrentPosition')
      .mockImplementation((success) => success(mockPosition as any));

    const { result } = renderHook(() => useGeolocation());
    await result.current.getCurrentLocation();

    expect(result.current.location).toEqual({
      lat: 37.5665,
      lon: 126.9780,
    });
  });

  it('should handle permission denied', async () => {
    jest.spyOn(navigator.geolocation, 'getCurrentPosition')
      .mockImplementation((_, error) => error!({
        code: 1,
        message: 'User denied Geolocation',
      } as any));

    const { result } = renderHook(() => useGeolocation());
    
    await expect(result.current.getCurrentLocation()).rejects.toThrow();
    expect(result.current.error?.code).toBe(1);
  });
});

// services/location/geocodingService.test.ts
describe('geocodingService', () => {
  it('should search locations', async () => {
    const results = await geocodingService.search('ê°•ë‚¨ì—­');
    
    expect(results.length).toBeGreaterThan(0);
    expect(results[0].location.lat).toBeDefined();
  });
});
```

### ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸

```typescript
// components/location/LocationSearchInput.test.tsx
describe('LocationSearchInput', () => {
  it('auto focuses on mount', () => {
    render(<LocationSearchInput value="" onChange={jest.fn()} />);
    
    expect(document.activeElement).toBe(screen.getByRole('textbox'));
  });

  it('shows clear button when has value', () => {
    render(<LocationSearchInput value="ê°•ë‚¨" onChange={jest.fn()} />);
    
    expect(screen.getByRole('button')).toBeInTheDocument();
  });
});
```

---

## âš ï¸ ì—ëŸ¬ ì²˜ë¦¬

| ì—ëŸ¬ ìƒí™© | ì—ëŸ¬ ì½”ë“œ | ì²˜ë¦¬ ë°©ë²• |
|----------|----------|----------|
| GPS ê¶Œí•œ ê±°ë¶€ | PERMISSION_DENIED | ìˆ˜ë™ ì…ë ¥ í™”ë©´ìœ¼ë¡œ ì•ˆë‚´ |
| GPS ì‚¬ìš© ë¶ˆê°€ | POSITION_UNAVAILABLE | "ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" í‘œì‹œ |
| GPS íƒ€ì„ì•„ì›ƒ | TIMEOUT | "ìœ„ì¹˜ í™•ì¸ì— ì‹œê°„ì´ ê±¸ë¦¬ê³  ìˆìŠµë‹ˆë‹¤" + ì¬ì‹œë„ |
| Geocoding ê²°ê³¼ ì—†ìŒ | - | "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤" í‘œì‹œ |
| API ì˜¤ë¥˜ | - | ì—ëŸ¬ ë©”ì‹œì§€ + ì¬ì‹œë„ ë²„íŠ¼ |

---

## ğŸ“Š ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­

| í•­ëª© | ëª©í‘œ |
|------|------|
| GPS íšë“ ì‹œê°„ | 10ì´ˆ íƒ€ì„ì•„ì›ƒ |
| ê²€ìƒ‰ ì‘ë‹µ ì‹œê°„ | 500ms ì´ë‚´ |
| ê²€ìƒ‰ ë””ë°”ìš´ìŠ¤ | 300ms |
| ìµœê·¼ ê²€ìƒ‰ ì €ì¥ | LocalStorage (ìµœëŒ€ 5ê°œ) |

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- [ ] ìœ„ì¹˜ ì •ë³´ëŠ” ì„œë²„ì— ì €ì¥í•˜ì§€ ì•ŠìŒ (í´ë¼ì´ì–¸íŠ¸ Only)
- [ ] HTTPS í™˜ê²½ì—ì„œë§Œ GPS ì‚¬ìš© ê°€ëŠ¥ (ë¸Œë¼ìš°ì € ì •ì±…)
- [ ] ìœ„ì¹˜ ê¶Œí•œ ê±°ë¶€ ì‹œ ì„œë¹„ìŠ¤ ì´ìš©ì— ë¬¸ì œ ì—†ë„ë¡ ëŒ€ì•ˆ ì œê³µ

---

## ë³€ê²½ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ë‚´ìš© | ì‘ì„±ì |
|------|------|----------|--------|
| 1.0 | 2024-12-04 | ìµœì´ˆ ì‘ì„± | - |


